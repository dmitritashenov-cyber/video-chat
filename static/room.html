<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>WebRTC Room</title>
  <style>
    body {
      background: #0f172a;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
    }
    video {
      width: 45%;
      margin: 10px;
      border-radius: 10px;
      background: black;
    }
    #status {
      margin: 10px;
      color: #38bdf8;
    }
  </style>
</head>
<body>

<h2>WebRTC Video Call</h2>
<div id="status">Connecting...</div>

<video id="localVideo" autoplay muted playsinline></video>
<video id="remoteVideo" autoplay playsinline></video>

<script>
const room = new URLSearchParams(window.location.search).get("room") || "test";
const statusEl = document.getElementById("status");
const localVideo = document.getElementById("localVideo");
const remoteVideo = document.getElementById("remoteVideo");

let pc;
let ws;
let localStream;

// ----------------------
// TURN CONFIG (FREE)
// ----------------------
const pcConfig = {
  iceServers: [
    {
      urls: [
        "turn:openrelay.metered.ca:80",
        "turn:openrelay.metered.ca:443",
        "turn:openrelay.metered.ca:3478"
      ],
      username: "openrelayproject",
      credential: "openrelayproject"
    }
  ],
  iceTransportPolicy: "relay"
};

// ----------------------
// INIT
// ----------------------
async function init() {
  status("Opening camera...");
  localStream = await navigator.mediaDevices.getUserMedia({
    video: true,
    audio: true
  });

  localVideo.srcObject = localStream;

  createPeer();

  connectWebSocket();
}

// ---------------
